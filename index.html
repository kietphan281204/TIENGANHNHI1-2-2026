<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>c√≥ 4 ph√∫t th√¥i n√≠ r√°ng l√†m x√≠u nh√©</title>

<style>
body{
  margin:0;
  font-family:Arial,Helvetica,sans-serif;
  background:#c5d818;
  color:white;
  padding:20px;
  overflow-x:hidden;
}
.container{
  max-width:900px;
  margin:auto;
  background:#1e293b;
  padding:20px;
  border-radius:16px;
  position:relative;
  z-index:1;
}
h1{text-align:center}
.timer{
  position:sticky;
  top:0;
  background:#facc15;
  color:rgb(0, 0, 0);
  padding:10px;
  text-align:center;
  border-radius:12px;
  font-size:20px;
  margin-bottom:16px;
  z-index:2;
}
.question{
  background:#b86196;
  padding:12px;
  border-radius:12px;
  margin-bottom:14px;
}
.answers label{
  display:block;
  padding:6px;
  border-radius:8px;
  margin:6px 0;
  cursor:pointer;
}
.correct{background:#14532d !important;color:#bbf7d0 !important}
.wrong{background:#7f1d1d !important;color:#fecaca !important}
button{
  display:block;
  margin:20px auto;
  padding:12px 26px;
  font-size:16px;
  border:none;
  border-radius:12px;
  background:#4f46e5;
  color:white;
  cursor:pointer;
}

/* ===== TUY·∫æT R∆†I ===== */
.snowflake{
  position:fixed;
  top:-10px;
  color:white;
  font-size:1em;
  user-select:none;
  z-index:9999;
  pointer-events:none;
  animation:fall linear infinite;
}
@keyframes fall{
  to{
    transform:translateY(100vh);
  }
}

/* ===== HI·ªÜU ·ª®NG CLICK ===== */
@keyframes clickEffect{
  0%{
    transform:translateY(0) scale(1);
    opacity:1;
  }
  100%{
    transform:translateY(-80px) scale(1.5);
    opacity:0;
  }
}
</style>
</head>

<body>
<div class="container">
<h1 id="quizTitle">ƒêang t·∫£i...</h1>

<div class="timer">
‚è± Th·ªùi gian n√≠ chi·∫øn ƒë·∫•u kkk: <span id="time">04:00</span>
</div>

<div id="quiz"></div>

<button onclick="submitQuiz()">N·ªôp b√†i</button>
</div>

<!-- üîä NH·∫†C N·ªÄN -->
<audio id="bgMusic" loop preload="auto">
  <source src="bai2.mp3" type="audio/mpeg">
</audio>

<script>
/* ===== D·ªÆ LI·ªÜU ===== */
let data=[
 ["Able","c√≥ th·ªÉ"],
 ["Abandon","b·ªè"],
 ["About","kho·∫£ng, v·ªÅ"],
 ["Above","l√™n, tr√™n"],
 ["Act","h√†nh ƒë·ªông"],
 ["Add","th√™m"],
 ["Afraid","s·ª£"],
 ["After","sau"],
 ["Again","l·∫°i"],
 ["Age","tu·ªïi"],
 ["Ago","tr∆∞·ªõc ƒë√¢y"],
 ["Agree","ƒë·ªìng √Ω"],
 ["Air","b·∫ßu kh√¥ng kh√≠"],
 ["All","t·∫•t c·∫£"],
 ["Allow","cho ph√©p"],
 ["Also","c≈©ng v·∫≠y"],
 ["Always","lu√¥n lu√¥n"],
 ["Among","·ªü gi·ªØa"],
 ["And","v√†"],
 ["Anger","t·ª©c gi·∫≠n"],
 ["Animal","ƒë·ªông v·∫≠t"],
 ["Answer","c√¢u tr·∫£ l·ªùi"],
 ["Appear","xu·∫•t hi·ªán"],
 ["Apple","qu·∫£ t√°o"],
 ["Area","di·ªán t√≠ch khu v·ª±c"],
 ["Arrange","s·∫Øp x·∫øp"],
 ["arrive","ƒë·∫øn"],
 ["art","ngh·ªá thu·∫≠t"],
 ["baby","em be"],
 ["back","tr·ªü l·∫°i"],
 ["ball","qu·∫£ b√≥ng"],
 ["bank","b·ªù"],
 ["bad","x·∫•u xa"]

];

/* ===== TR·ªòN ===== */
function shuffle(a){
  for(let i=a.length-1;i>0;i--){
    let j=Math.floor(Math.random()*(i+1));
    [a[i],a[j]]=[a[j],a[i]];
  }
  return a;
}

data=shuffle(data);
const quiz=document.getElementById("quiz");

/* ===== T·∫†O C√ÇU H·ªéI ===== */
data.forEach((q,i)=>{
  const correct=q[1];
  const wrong=shuffle(
    data.map(x=>x[1]).filter(v=>v!==correct)
  ).slice(0,3);

  const answers=shuffle([correct,...wrong]);

  const div=document.createElement("div");
  div.className="question";
  div.dataset.correct=correct;

  div.innerHTML=`
    <strong>C√¢u ${i+1}: ${q[0]}</strong>
    <div class="answers">
      ${answers.map((a,j)=>`
        <label>
          <input type="radio" name="q${i}" value="${a}">
          ${String.fromCharCode(65+j)}. ${a}
        </label>
      `).join("")}
    </div>
  `;
  quiz.appendChild(div);
});

/* ===== PH√ÅT NH·∫†C 1 L·∫¶N DUY NH·∫§T ===== */
const bgMusic = document.getElementById("bgMusic");
let musicStarted = false;

document.addEventListener("change", e=>{
  if(e.target.type==="radio" && !musicStarted){
    bgMusic.volume = 0.4;
    bgMusic.play();
    musicStarted = true;
  }
});

/* ===== ƒê·ªíNG H·ªí ===== */
let timeLeft=240;
let submitted=false;
const timeEl=document.getElementById("time");

const timer=setInterval(()=>{
  const m=Math.floor(timeLeft/60);
  const s=timeLeft%60;
  timeEl.textContent=
    `${String(m).padStart(2,"0")}:${String(s).padStart(2,"0")}`;

  if(timeLeft<=0){
    clearInterval(timer);
    if(!submitted){
      alert("‚è∞ H·∫øt gi·ªù!");
      submitQuiz();
    }
  }
  timeLeft--;
},1000);

/* ===== N·ªòP B√ÄI ===== */
function submitQuiz(){
  if(submitted) return;
  submitted=true;
  clearInterval(timer);

  /* D·ª™NG NH·∫†C */
  bgMusic.pause();
  bgMusic.currentTime = 0;

  let score=0;

  document.querySelectorAll(".question").forEach(q=>{
    const correct=q.dataset.correct;
    const chosen=q.querySelector("input:checked");

    // ƒê√°nh d·∫•u ƒë√°p √°n ƒë√∫ng
    q.querySelectorAll("label").forEach(lb=>{
      const input=lb.querySelector("input");
      const v=input.value;
      if(v===correct){
        lb.classList.add("correct");
      }
    });

    // Ki·ªÉm tra ƒë√°p √°n ƒë√£ ch·ªçn
    if(chosen){
      if(chosen.value===correct){
        score++;
      }else{
        // Ch·ªâ t√¥ ƒë·ªè n·∫øu ch·ªçn SAI
        chosen.parentElement.classList.add("wrong");
      }
    }
  });

  document.querySelectorAll("input").forEach(i=>i.disabled=true);

  const totalQuestions = data.length;
  const percentage = Math.floor((score / totalQuestions) * 100);
  
  let message="";
  if(score===totalQuestions){
    message="üèÜ Nhi th·∫≠t tuy·ªát v·ªùi qu√° 10 ƒëi·ªÉm g√≥t ch√≥p nƒÉm b·ªù vang!";
  }else if(percentage>=83){
    message="üëè Nhi gi·ªèi qu√°!";
  }else if(percentage>=67){
    message="ü§î Qu√™n r·ªìi ch·ª© g√¨!";
  }else if(percentage>=50){
    message="üò¢ Nhi l√†m t√¥i bu·ªìn hen!";
  }else{
    message="üò¥ C·ªë g·∫Øng h∆°n nh√©!";
  }

  alert(
    "üéØ K·∫æT QU·∫¢ NHI √à\n\n" +
    "‚úÖ ƒê√∫ng: " + score + " / " + totalQuestions + " c√¢u\n\n" +
    message
  );

  // G·ª≠i k·∫øt qu·∫£ qua email
  sendResultEmail(score, totalQuestions, message);
}

/* ===== HI·ªÜU ·ª®NG TUY·∫æT R∆†I ===== */
function createSnowflake(){
  const snowflake=document.createElement("div");
  snowflake.className="snowflake";
  snowflake.innerHTML="‚ùÑ";
  snowflake.style.left=Math.random()*100+"%";
  snowflake.style.animationDuration=Math.random()*3+2+"s";
  snowflake.style.opacity=Math.random();
  snowflake.style.fontSize=Math.random()*10+10+"px";
  document.body.appendChild(snowflake);
  setTimeout(()=>{
    snowflake.remove();
  },5000);
}
setInterval(createSnowflake,200);

/* ===== HI·ªÜU ·ª®NG KHI CLICK ===== */
document.addEventListener("click", e=>{
  const colors=["‚ù§Ô∏è","üíñ","‚ú®","‚≠ê","üåü","üí´","üéâ","üéä"];
  const emoji=colors[Math.floor(Math.random()*colors.length)];
  
  const effect=document.createElement("div");
  effect.textContent=emoji;
  effect.style.position="fixed";
  effect.style.left=e.clientX+"px";
  effect.style.top=e.clientY+"px";
  effect.style.fontSize="24px";
  effect.style.pointerEvents="none";
  effect.style.zIndex="10000";
  effect.style.animation="clickEffect 1s ease-out forwards";
  
  document.body.appendChild(effect);
  
  setTimeout(()=>{
    effect.remove();
  },1000);
});

/* ===== G·ª¨I K·∫æT QU·∫¢ QUA EMAIL (Formspree - D·ªÖ d√†ng) ===== */
function sendResultEmail(score, totalQuestions, message) {
  // ‚úÖ ƒê√£ c·∫•u h√¨nh Formspree endpoint
  const FORMPREE_ENDPOINT = "https://formspree.io/f/xrepvazp";
  
  // N·∫øu ch∆∞a c·∫•u h√¨nh, d√πng c√°ch mailto (m·ªü ·ª©ng d·ª•ng email)
  if (FORMPREE_ENDPOINT.includes("YOUR_FORMPREE")) {
    // C√°ch d·ª± ph√≤ng: M·ªü ·ª©ng d·ª•ng email v·ªõi n·ªôi dung s·∫µn
    const emailSubject = encodeURIComponent(`üéØ K·∫øt qu·∫£ Quiz: ${score}/${totalQuestions} c√¢u ƒë√∫ng`);
    const emailBody = encodeURIComponent(
      `K·∫øt qu·∫£ b√†i quiz ti·∫øng Anh:\n\n` +
      `‚úÖ ƒê√∫ng: ${score} / ${totalQuestions} c√¢u\n` +
      `üìä T·ª∑ l·ªá: ${Math.floor((score / totalQuestions) * 100)}%\n` +
      `‚è±Ô∏è Th·ªùi gian: ${Math.floor((240 - timeLeft) / 60)} ph√∫t ${((240 - timeLeft) % 60)} gi√¢y\n` +
      `üìÖ Ng√†y: ${new Date().toLocaleString('vi-VN')}\n\n` +
      `${message}`
    );
    
    window.location.href = `mailto:kietphan28122004@gmail.com?subject=${emailSubject}&body=${emailBody}`;
    return;
  }

  // G·ª≠i qua Formspree
  const formData = {
    _to: "kietphan28122004@gmail.com",
    _subject: `üéØ K·∫øt qu·∫£ Quiz: ${score}/${totalQuestions} c√¢u ƒë√∫ng`,
    score: score,
    total: totalQuestions,
    percentage: Math.floor((score / totalQuestions) * 100),
    message: message,
    date: new Date().toLocaleString('vi-VN'),
    time_spent: Math.floor((240 - timeLeft) / 60) + " ph√∫t " + ((240 - timeLeft) % 60) + " gi√¢y",
    result_text: `ƒê√∫ng: ${score}/${totalQuestions} c√¢u (${Math.floor((score / totalQuestions) * 100)}%)`
  };

  fetch(FORMPREE_ENDPOINT, {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "Accept": "application/json"
    },
    body: JSON.stringify(formData)
  })
  .then(response => {
    if (response.ok) {
      console.log('‚úÖ Email ƒë√£ ƒë∆∞·ª£c g·ª≠i th√†nh c√¥ng!');
    } else {
      throw new Error('L·ªói g·ª≠i email');
    }
  })
  .catch(error => {
    console.log('‚ùå L·ªói g·ª≠i email:', error);
    // Fallback: d√πng mailto n·∫øu Formspree l·ªói
    const emailSubject = encodeURIComponent(`üéØ K·∫øt qu·∫£ Quiz: ${score}/${totalQuestions} c√¢u ƒë√∫ng`);
    const emailBody = encodeURIComponent(
      `K·∫øt qu·∫£ b√†i quiz ti·∫øng Anh:\n\n` +
      `‚úÖ ƒê√∫ng: ${score} / ${totalQuestions} c√¢u\n` +
      `üìä T·ª∑ l·ªá: ${Math.floor((score / totalQuestions) * 100)}%\n` +
      `‚è±Ô∏è Th·ªùi gian: ${Math.floor((240 - timeLeft) / 60)} ph√∫t ${((240 - timeLeft) % 60)} gi√¢y\n` +
      `üìÖ Ng√†y: ${new Date().toLocaleString('vi-VN')}\n\n` +
      `${message}`
    );
    window.location.href = `mailto:kietphan28122004@gmail.com?subject=${emailSubject}&body=${emailBody}`;
  });
}
</script>
</body>
</html>